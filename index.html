document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("themeToggle");
  const label = document.getElementById("themeLabel");
  const icon = document.getElementById("themeIcon");
  const switchEl = document.getElementById("themeSwitch");

  if (!toggle || !label || !icon || !switchEl) return;

  // Lê preferência salva (ou usa preferência do sistema)
  function getInitialTheme() {
    try {
      const saved = localStorage.getItem("theme");
      if (saved === "light") return true;
      if (saved === "dark") return false;
    } catch {}

    // Preferência do sistema
    try {
      return window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: light)").matches;
    } catch {}

    return false; // padrão: dark
  }

  function applyTheme(isLight, save = true) {
    // checkbox controla o CSS via :checked
    toggle.checked = isLight;

    // Texto e ícone
    label.textContent = isLight ? "Light Mode" : "Dark Mode";
    icon.className = isLight ? "fa-solid fa-sun" : "fa-solid fa-moon";

    // Acessibilidade
    switchEl.setAttribute("aria-checked", String(isLight));

    // Salvar
    if (save) {
      try {
        localStorage.setItem("theme", isLight ? "light" : "dark");
      } catch {}
    }
  }

  // Inicializa
  applyTheme(getInitialTheme(), false);

  // Mudança
  toggle.addEventListener("change", () => {
    applyTheme(toggle.checked, true);
  });

  // (Opcional) clicar no rótulo/switch já funciona pelo "for",
  // mas mantém compatibilidade caso você clique no container em algum momento
  switchEl.addEventListener("click", () => {
    // o click no label já alterna o checkbox automaticamente,
    // então só sincronizamos na sequência
    setTimeout(() => applyTheme(toggle.checked, true), 0);
  });
});
